name: Sapog tests
on: push
jobs:
  heartbeat:
    runs-on: [ self-hosted ]
    steps:
      - name: Powering off Sapog
        run: groom_power.py outputoff
      - name: Turning on the USB port
        run: sudo ykushcmd ykush3 -u 1
      - name: Building Sapog
      	run: python firmware/tests/src/builder.py build
      - name: Powering off Sapog
        run: groom_power.py outputoff
      - name: Powering on Sapog
        run: groom_power.py outputon
      - name: Flashing Sapog
      	run: python firmware/tests/src/builder.py flash
      - name: Restarting
        run: python firmware/tests/src/tester.py
      - name: Cleanup
    	if: ${{ failure() }}
    	run: |
    	  sudo ykushcmd ykush3 -d 1
    	  groom_power.py poweroff
